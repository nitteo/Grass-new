"use strict";(self["webpackChunkobs_swap"]=self["webpackChunkobs_swap"]||[]).push([[594],{59594:function(t,s,e){e.r(s),e.d(s,{default:function(){return R}});var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"trade"},[s("div",{staticClass:"trade_bg"}),s("div",{staticClass:"trade_card"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowSwap,expression:"isShowSwap"}],staticClass:"swap"},[s("div",{staticClass:"swap_header"},[s("div",{staticClass:"swap_title"},[t._v(t._s(t.$t("message.trade.swap")))]),s("img",{staticClass:"swap_setting",attrs:{alt:"setting",src:e(81978)},on:{click:t.handleSetting}})]),s("div",{staticClass:"swap_from"},[s("div",{staticClass:"swap_from_title"},[t._v(t._s(t.$t("message.trade.swapFrom")))]),s("div",{staticClass:"swap_from_input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.fromInput,expression:"fromInput"}],attrs:{placeholder:"0",type:"number"},domProps:{value:t.fromInput},on:{input:[function(s){s.target.composing||(t.fromInput=s.target.value)},function(s){return t.inputChange(0,s)}]}}),""===t.fromCur.symbol?s("div",{staticClass:"swap_select_coin",on:{click:function(s){return t.handleShowToken("from")}}},[s("span",[t._v(t._s(t.$t("message.trade.selectToken")))]),s("img",{staticClass:"img_down",attrs:{alt:"down",src:e(12275)}})]):s("div",{staticClass:"swap_from_coin",on:{click:function(s){return t.handleShowToken("from")}}},[s("van-image",{staticClass:"img_coin",attrs:{src:t.fromCur.logoURI,alt:"coin",round:""}}),s("span",[t._v(t._s(t.fromCur.symbol))]),s("img",{staticClass:"img_down",attrs:{alt:"down",src:e(12275)}})],1)]),s("div",{staticClass:"swap_from_quick"},t._l(t.quickList,(function(e,i){return s("div",{key:i,on:{click:function(s){return t.handleQuickSwap(i)}}},[s("div",{staticClass:"swap_from_quick_wrapper"},[s("span",[t._v(t._s(e.percent))])])])})),0),s("div",{staticClass:"swap_from_balance"},[t._v(t._s(t.$t("message.trade.balance"))+": "+t._s(parseFloat(t.fromCur.balance)>=0?t.fromCur.balance:"-"))])]),s("div",{staticClass:"swap_switch"},[s("div",{staticClass:"swap_line"}),s("div",{staticClass:"swap_box"},[s("img",{staticClass:"img_switch",attrs:{alt:"switch",src:e(48911)},on:{click:t.handleSwitch}})])]),s("div",{staticClass:"swap_from marginTop10"},[s("div",{staticClass:"swap_from_title"},[t._v(t._s(t.$t("message.trade.swapTo")))]),s("div",{staticClass:"swap_from_input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.toInput,expression:"toInput"}],attrs:{placeholder:"0",type:"number"},domProps:{value:t.toInput},on:{input:[function(s){s.target.composing||(t.toInput=s.target.value)},function(s){return t.inputChange(1,s)}]}}),""===t.toCur.symbol?s("div",{staticClass:"swap_select_coin",on:{click:function(s){return t.handleShowToken("to")}}},[s("span",[t._v(t._s(t.$t("message.trade.selectToken")))]),s("img",{staticClass:"img_down",attrs:{alt:"down",src:e(12275)}})]):s("div",{staticClass:"swap_from_coin",on:{click:function(s){return t.handleShowToken("to")}}},[s("van-image",{staticClass:"img_coin",attrs:{src:t.toCur.logoURI,alt:"coin",round:""}}),s("span",[t._v(t._s(t.toCur.symbol))]),s("img",{staticClass:"img_down",attrs:{alt:"down",src:e(12275)}})],1)]),s("div",{staticClass:"swap_from_balance"},[t._v(t._s(t.$t("message.trade.balance"))+": "+t._s(parseFloat(t.toCur.balance)>=0?t.toCur.balance:"-"))])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.priceShow,expression:"priceShow"}],staticClass:"swap_flex_price"},[s("span",[t._v(t._s(t.$t("message.trade.price")))]),s("div",[s("span",[t._v(t._s(t.price)+" "+t._s(t.priceDirection?t.fromCur.symbol:t.toCur.symbol)+" pre "+t._s(t.priceDirection?t.toCur.symbol:t.fromCur.symbol))]),s("img",{attrs:{alt:"refresh",src:e(86339)},on:{click:t.changePriceDirection}})])]),t.walletAddress?t.insufficientLiquidityShow?s("div",{staticClass:"swap_submit_unavailable",attrs:{disabled:""}},[t._v(t._s(t.$t("message.trade.insufficientLiquidity")))]):t.getNoInputBtnShow?s("div",{staticClass:"swap_submit_unavailable",attrs:{disabled:""}},[t._v(t._s(t.$t("message.trade.enterAmount")))]):t.getNoBalanceBtnShow?s("div",{class:t.priceShow?"swap_submit_unavailable marginTopSubmit":"swap_submit_unavailable",attrs:{disabled:""}},[t._v(t._s(t.$t("message.trade.insufficientBalance")))]):t.getNoSelectBtnShow?s("div",{staticClass:"swap_submit_unavailable",attrs:{disabled:"",type:"default"}},[t._v(t._s(t.$t("message.trade.selectToken")))]):t.allowanceToRouter?s("div",{staticClass:"swap_submit",on:{click:t.handleApprove}},[t._v(t._s(t.$t("message.trade.approve")))]):t.getWrap?s("div",{staticClass:"swap_submit",on:{click:t.handleDeposit}},[t._v(t._s("Swap"))]):t.getWithdraw?s("div",{staticClass:"swap_submit",on:{click:t.handleWithdraw}},[t._v(t._s("Swap"))]):s("div",{staticClass:"swap_submit",on:{click:t.handleSwap}},[t._v(t._s(t.$t("message.trade.swap")))]):s("div",{staticClass:"swap_submit",on:{click:t.handleLogin}},[t._v(t._s(t.$t("message.trade.connectWallet")))]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.priceShow,expression:"priceShow"}],staticClass:"swap_bottom"},[s("div",{staticClass:"swap_bottom_text"},[s("div",[s("span",[t._v(t._s("from"===t.inputSource?t.$t("message.trade.minimumReceived"):t.$t("message.trade.maximumSold")))]),s("img",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:(t.screenWidth,"right"),arrow:!0},expression:"{ placement : screenWidth<960?'right':'right',  arrow: true }"}],attrs:{content:t.$t("message.trade.minimumReceivedPrompt"),alt:"prompt",src:e(46867)}})]),s("span",[t._v(t._s("from"===t.inputSource?this.inputOutMin:this.inputInMax)+" "+t._s("from"===t.inputSource?t.toCur.symbol:t.fromCur.symbol))])]),s("div",{staticClass:"swap_bottom_text"},[s("div",[s("span",[t._v(t._s(t.$t("message.trade.priceImpact")))]),s("img",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:(t.screenWidth,"right"),arrow:!0},expression:"{ placement : screenWidth<960?'right':'right',  arrow: true }"}],attrs:{content:t.$t("message.trade.priceImpactPrompt"),alt:"prompt",src:e(46867)}})]),s("span",[t._v(t._s(t.priceImpact))])]),s("div",{staticClass:"swap_bottom_text"},[s("div",[s("span",[t._v(t._s(t.$t("message.trade.liquidityProviderFee")))]),s("img",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:(t.screenWidth,"right"),arrow:!0},expression:"{ placement : screenWidth<960?'right':'right',  arrow: true }"}],attrs:{content:t.$t("message.trade.liquidityProviderFeePrompt",{fee:t.fee}),alt:"prompt",src:e(46867)}})]),s("span",[t._v(t._s(t.fee)+" "+t._s(t.fromCur.symbol))])])])]),t.isShowSwap?t._e():s("swap-confirm",{attrs:{fromCur:t.fromCur,swapDetail:t.swapDetail,toCur:t.toCur},on:{listenClose:t.handleBack,listenConfirm:t.handleConfirm}})],1),t.isShowSetting?s("van-popup",{attrs:{"close-on-click-overlay":!1,round:""},model:{value:t.isShowSetting,callback:function(s){t.isShowSetting=s},expression:"isShowSetting"}},[s("swap-setting",{on:{listenClose:t.handleCloseSetting}})],1):t._e(),t.isShowToken?s("van-popup",{attrs:{"close-on-click-overlay":!1,round:""},model:{value:t.isShowToken,callback:function(s){t.isShowToken=s},expression:"isShowToken"}},[s("swap-token-list",{on:{listenClose:t.handleCloseToken,listenImport:t.handleShowImport,listenManage:t.handleManage,listenSelectCurrency:t.handleSelect}})],1):t._e(),t.isShowImport?s("van-popup",{attrs:{"close-on-click-overlay":!1,round:""},model:{value:t.isShowImport,callback:function(s){t.isShowImport=s},expression:"isShowImport"}},[s("import-token",{attrs:{currency:this.importCurrency},on:{listenClose:t.handleCloseImport,listenImport:t.handleImport}})],1):t._e(),t.isShowManage?s("van-popup",{attrs:{"close-on-click-overlay":!1,round:""},model:{value:t.isShowManage,callback:function(s){t.isShowManage=s},expression:"isShowManage"}},[s("manage-token")],1):t._e(),t.pendingDetailShow?s("van-popup",{attrs:{"close-on-click-overlay":!1,round:""},model:{value:t.pendingDetailShow,callback:function(s){t.pendingDetailShow=s},expression:"pendingDetailShow"}},[t.pendingDetailShow?s("pending-swap",{attrs:{fromCur:t.fromCur,pendingDetail:t.pendingDetail,toCur:t.toCur},on:{listenClose:t.handleClosePending}}):t._e()],1):t._e()],1)},a=[],r=(e(30381),e(75231),e(21977),e(62420),e(26980),e(76133),e(56088)),o=e(50651),n=e(72403),h=e(15260),l=e(93570),c=e(87275),p=e(72708),u=e(34492),d=e(48836),m=function(){var t=this,s=t._self._c;return s("div")},w=[],g={name:"transactionRecord"},f=g,C=e(50876),v=(0,C.A)(f,m,w,!1,null,"899642f2",null),I=v.exports,_=e(68959),S=e(86177),T=e(27555),y=function(){var t=this,s=t._self._c;return s("div",{staticClass:"confirm_swap"},[s("div",{staticClass:"confirm_swap_header"},[s("img",{staticClass:"swap_back",attrs:{alt:"back",src:e(75051)},on:{click:t.handleClose}}),s("div",{staticClass:"swap_title"},[t._v(t._s(t.$t("message.trade.confirmSwap")))])]),s("div",{staticClass:"swap_from"},[s("div",{staticClass:"swap_from_title"},[t._v(t._s(t.$t("message.trade.from")))]),s("div",{staticClass:"swap_from_coin"},[s("span",[t._v(t._s(t.swapDetail.fromInput)+" "+t._s(t.fromCur.symbol))]),s("van-image",{staticClass:"img_coin",attrs:{src:t.fromCur.logoURI,alt:"coin",round:""}})],1)]),s("div",{staticClass:"swap_from marginTop10"},[s("span",{staticClass:"swap_from_title"},[t._v(t._s(t.$t("message.trade.to")))]),s("div",{staticClass:"swap_from_coin"},[s("span",[t._v(t._s(t.swapDetail.toInput)+" "+t._s(t.toCur.symbol))]),s("van-image",{staticClass:"img_coin",attrs:{src:t.toCur.logoURI,alt:"coin",round:""}})],1)]),s("div",{staticClass:"swap_text"},[t._v(t._s(t.$t("message.trade.confirmSwapText",{toInput:t.swapDetail.toInput,symbol:t.toCur.symbol})))]),s("div",{staticClass:"swap_flex_price"},[s("span",[t._v(t._s(t.$t("message.trade.price")))]),s("div",[s("span",[t._v(t._s(t.swapDetail.price)+" "+t._s(t.priceDirection?t.fromCur.symbol:t.toCur.symbol)+" pre "+t._s(t.priceDirection?t.toCur.symbol:t.fromCur.symbol))]),s("img",{attrs:{alt:"refresh",src:e(86339)},on:{click:t.changePriceDirection}})])]),s("div",{staticClass:"swap_bottom"},[s("div",{staticClass:"swap_bottom_text"},[s("div",[s("span",[t._v(t._s("from"===t.swapDetail.inputSource?t.$t("message.trade.minimumReceived"):t.$t("message.trade.maximumSold")))]),s("img",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:(t.screenWidth,"right"),arrow:!0},expression:"{ placement : screenWidth<960?'right':'right',  arrow: true }"}],attrs:{content:t.$t("message.trade.minimumReceivedPrompt"),alt:"prompt",src:e(46867)}})]),s("span",[t._v(t._s("from"===t.swapDetail.inputSource?t.swapDetail.inputOutMin:t.swapDetail.inputInMax)+" "+t._s("from"===t.swapDetail.inputSource?t.toCur.symbol:t.fromCur.symbol))])]),s("div",{staticClass:"swap_bottom_text"},[s("div",[s("span",[t._v(t._s(t.$t("message.trade.priceImpact"))+" ")]),s("img",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:(t.screenWidth,"right"),arrow:!0},expression:"{ placement : screenWidth<960?'right':'right',  arrow: true }"}],attrs:{content:t.$t("message.trade.priceImpactPrompt"),alt:"prompt",src:e(46867)}})]),s("span",[t._v(t._s(t.swapDetail.priceImpact))])]),s("div",{staticClass:"swap_bottom_text"},[s("div",[s("span",[t._v(t._s(t.$t("message.trade.liquidityProviderFee")))]),s("img",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:(t.screenWidth,"right"),arrow:!0},expression:"{ placement : screenWidth<960?'right':'right',  arrow: true }"}],attrs:{content:t.$t("message.trade.liquidityProviderFeePrompt",{fee:t.swapDetail.fee}),alt:"prompt",src:e(46867)}})]),s("span",[t._v(t._s(t.swapDetail.fee)+t._s(t.fromCur.symbol))])])]),s("div",{staticClass:"swap_submit",on:{click:t.handleConfirm}},[t._v(t._s(t.$t("message.trade.swap")))])])},b=[],$={name:"swapConfirm",props:["fromCur","toCur","swapDetail"],data(){return{priceDirection:!0}},computed:{...(0,o.L8)(["screenWidth"])},mounted(){},methods:{handleConfirm(){this.$emit("listenConfirm")},handleClose(){this.$emit("listenClose")},changePriceDirection(){this.priceDirection=!this.priceDirection,this.getPairPrice()},getPairPrice(){const t=parseFloat(this.swapDetail.fromInput),s=parseFloat(this.swapDetail.toInput);if(this.priceDirection){const e=(0,h.F8)(t,s);this.swapDetail.price=(0,h.QX)(e)}else{const e=(0,h.F8)(s,t);this.swapDetail.price=(0,h.QX)(e)}}}},D=$,k=(0,C.A)(D,y,b,!1,null,"d69fe7ea",null),A=k.exports,x=e(80938);function P(t,s){var e=0;const i=c.Ay.getWeb3ModalProvider(!1);let a=setInterval((()=>{e++,i.eth.getTransactionReceipt(t).then((function(t){null==t?console.log("轮询查找交易状态为空"):t.status?(s(t),clearInterval(a),console.log("轮询查找交易已经完成")):(s(t),clearInterval(a),console.log("轮询查找返回交易失败"))})),e>10&&(clearInterval(a),s(result),console.log("轮询查找交易时间超时"))}),2e3)}var F=e(86205),E=e(77662),B=e(22853),H=e(2642),M=e(50223);const W=e(93853);var N={name:"swap",components:{swapTokenList:S.A,swapSetting:T.A,importToken:x.A,swapConfirm:A,pendingSwap:_.A,transactionRecord:I},data(){return{inputOutMin:"",inputInMax:"",priceImpact:"",fee:"",importCurrency:"",isShowSwap:!0,isShowSetting:!1,isShowToken:!1,isShowImport:!1,isShowManage:!1,inputSource:"",fromInput:"",autoFillCurrency:{inputCurrency:"",outputCurrency:""},fromCur:{chainId:(0,c.F2)(),address:(0,u.FI)(),decimals:18,symbol:"INI",name:"INI",balance:"-",logoURI:(0,c.MY)()+(0,u.FI)()+".png"},toInput:"",toCur:{chainId:"",address:"",decimals:"",symbol:"",name:"",balance:"-",logoURI:""},tokenSource:"from",priceDirection:!0,price:"",priceShow:!1,swapDetail:{fromInput:"",toInput:"",inputInMax:0,inputOutMin:0,path:[],to:"",deadline:0,inputSource:"from",priceImpact:"",fee:0},approveLoading:!1,pendingDetailShow:!1,transactionRecordShow:!1,pendingDetail:{status:0,type:"",hash:"",fromInput:"",toInput:""},allowanceToRouter:!1,insufficientLiquidityShow:!1,quickList:[{percent:"25%",isSelect:!1},{percent:"50%",isSelect:!1},{percent:"75%",isSelect:!1},{percent:"MAX",isSelect:!1}]}},beforeDestroy(){window.clearInterval(this.timerBalance),window.clearInterval(this.timerAllPair)},created(){this.initialization(),this.handleTimerGetAllPair()},mounted(){const t=this.$route.query.inputCurrency,s=this.$route.query.outputCurrency;t&&s&&(this.autoFillCurrency.inputCurrency=t,this.autoFillCurrency.outputCurrency=s,this.getTokenListRequest())},watch:{isConnectWallet(t,s){t||this.extractMethod1()},currentNetworkID(t,s){t!==s&&(this.extractMethod1(),setTimeout((()=>{this.initialization(),this.handleTimerGetAllPair(),this.getTokenListRequest()}),100))},walletAddress(t,s){t&&(this.initialization(),this.handleTimerGetAllPair())},slippage(){this.handleTimerGetAllPair()},multipath(){this.handleTimerGetAllPair()}},computed:{...(0,o.L8)(["isConnectWallet","currentNetworkID","walletAddress","gasPrice","slippage","deadline","multipath","screenWidth"]),getNoBalanceBtnShow(){return(0,h.Tv)(this.fromInput,this.fromCur.balance)},getNoInputBtnShow(){return(0===parseFloat(this.fromInput)||""===this.fromInput)&&""!==this.fromCur.address||(0===parseFloat(this.toInput)||""===this.toInput)&&""!==this.toCur.address},getNoSelectBtnShow(){return""==this.fromCur.address||""==this.toCur.address},getWrap(){return(0,l.J)(this.fromCur)&&this.toCur.address==this.fromCur.address},getWithdraw(){return(0,l.J)(this.toCur)&&this.toCur.address==this.fromCur.address}},methods:{extractMethod1(){this.fromInput="",this.toInput="",this.price="",this.priceShow=!1,this.pendingDetailShow=!1,this.fromCur={chainId:(0,c.F2)(),address:(0,u.FI)(),decimals:18,symbol:"INI",name:"INI",balance:"-",logoURI:(0,c.MY)()+(0,u.FI)()+".png"},this.toCur={chainId:"",address:"",decimals:"",symbol:"",name:"",balance:"-",logoURI:""},this.swapDetail={fromInput:"",toInput:"",inputInMax:0,inputOutMin:0,path:[],to:"",deadline:0,inputSource:"from",priceImpact:"",fee:0}},handleLogin(){this.$eventBus.$emit("setWallet")},async handleApprove(){const t=(0,n.H7)(this.fromCur.address),s=d.Is.toString(),e=(0,u.Ch)(),i=await t.methods.approve(e,s).estimateGas({from:this.walletAddress});this.approveLoading=!0,this.pendingDetail={status:0,type:"0",hash:"",fromInput:"",toInput:""},this.pendingDetailShow=!0,t.methods.approve(e,s).send({from:this.walletAddress,gas:(0,h.l4)(i),gasPrice:p.Ay$.utils.numberToHex(this.gasPrice)}).on("transactionHash",(t=>{const s={title:"",hash:t,message:`'approve' ${this.fromCur.symbol}`,addedTime:(new Date).getTime(),from:this.walletAddress};this.$store.dispatch("wallet/setTransactions",s)})).on("receipt",(t=>{this.handleApproveBtnShow(),this.approveLoading=!1,this.pendingDetailShow=!1})).on("error",((t,s)=>{throw this.approveLoading=!1,this.pendingDetailShow=!1,this.handleApproveBtnShow(),t}))},async handleApproveBtnShow(){if((0,l.J)(this.fromCur)||""==this.fromCur.address)this.allowanceToRouter=!1;else if(this.walletAddress){const t=(0,n.H7)(this.fromCur.address),s=(0,u.Ch)(),e=await t.methods.allowance(this.walletAddress,s).call();this.allowanceToRouter=0==e}},inputChange(t){if(0===t){const t=this.fromInput,s=/^[0-9]*\.?[0-9]*$/;s.test(t)?""===t&&(this.fromInput=" "):this.fromInput=this.fromInput.slice(0,-1),this.inputSource="from"}else{const t=this.toInput,s=/^[0-9]*\.?[0-9]*$/;s.test(t)?""===t&&(this.toInput=" "):this.toInput=this.toInput.slice(0,-1),this.inputSource="to"}this.getAmounts()},handleSwap(){this.isShowSwap=!1,this.setSwapDetail()},handleBack(){this.isShowSwap=!0},handleConfirm(){const t=(0,h.F8)(this.slippage,100),s=(0,h.C_)(this.fromInput,this.fromCur.decimals),e=(0,h.Mg)((0,h.BS)(s,(0,h.iE)(s,t)),0),i=(0,h.C_)(this.toInput,this.toCur.decimals),a=(0,h.Mg)((0,h.O)(i,(0,h.iE)(i,t)),0);let r=this.currentTrade.route.path.map((t=>t.address));const o=this.walletAddress,n=(0,h.BS)((0,h.F8)(Date.parse(new Date),1e3),(0,h.iE)(this.deadline,60));this.pendingDetail.type="1",this.pendingDetail.fromInput=this.fromInput,this.pendingDetail.toInput=this.toInput,(0,l.J)(this.fromCur)&&"from"==this.inputSource?this.swapExactETHForTokens(s,a,r,o,n):(0,l.J)(this.fromCur)&&"to"==this.inputSource?this.swapETHForExactTokens(i,e,r,o,n):(0,l.J)(this.toCur)&&"from"==this.inputSource?this.swapExactTokensForETH(s,a,r,o,n):(0,l.J)(this.toCur)&&"to"==this.inputSource?this.swapTokensForExactETH(i,e,r,o,n):"from"!=this.inputSource?"to"!=this.inputSource||this.swapTokensForExactTokens(i,e,r,o,n):this.swapExactTokensForTokens(s,a,r,o,n)},handleQuickSwap(t){const s=this.fromCur;if(!this.isConnectWallet)return;if((0,B.ZS)(s.address))return;if(parseFloat(s.balance)<=0)return;const e=[.25,.5,.75,1],i=e[t],a=(0,h.iE)(s.balance,i);this.fromInput=a,this.inputChange(0)},handleSwapDetailClosed(){this.swapDetail={fromInput:"",toInput:"",inputInMax:0,inputOutMin:0,path:[],to:"",deadline:0,inputSource:"from",priceImpact:"",fee:0}},handleClosePending(){this.pendingDetailShow=!1,this.handlePendingSwapClosed(),this.handleSwapDetailClosed()},handlePendingSwapClosed(){this.pendingDetail={status:0,type:"",hash:"",fromInput:"",toInput:""}},async handleToMax(){this.fromInput=this.fromCur.balance,this.inputSource="from",this.getAmounts()},async initialization(){await this.handleCurBalance(),await this.handleTimerBalance()},async handleCurBalance(){if(this.walletAddress){if((0,l.J)(this.fromCur)){const t=await c.Ay.getWeb3ModalProvider(!1).eth.getBalance(this.walletAddress),s=(0,h.QX)((0,h.ej)(t));this.fromCur={...this.fromCur,balance:s}}if(!(0,l.J)(this.fromCur)&&""!==this.fromCur.address){const t=(0,n.H7)(this.fromCur.address),s=await t.methods.balanceOf(this.walletAddress).call(),e=(0,h.QX)((0,h.ej)(s,this.fromCur.decimals));this.fromCur={...this.fromCur,balance:e}}if((0,l.J)(this.toCur)){const t=await c.Ay.getWeb3ModalProvider(!1).eth.getBalance(this.walletAddress),s=(0,h.QX)((0,h.ej)(t));this.toCur={...this.toCur,balance:s}}if(!(0,l.J)(this.toCur)&&""!==this.toCur.address){const t=(0,n.H7)(this.toCur.address),s=await t.methods.balanceOf(this.walletAddress).call(),e=(0,h.QX)((0,h.ej)(s,this.toCur.decimals));this.toCur={...this.toCur,balance:e}}}},async handleTimerBalance(){window.clearTimeout(this.timerBalance),this.timerBalance=setInterval((async()=>{await this.handleCurBalance()}),3e3)},async getTokenListRequest(){if(!M.x9.includes(this.currentNetworkID))return;const t={chainID:(0,c.F2)()},s=await(0,F.i)(t);if(s){const t=this.autoFillCurrency.inputCurrency,e=this.autoFillCurrency.outputCurrency,i=s.tokens;let a=i.find((s=>s.address.toLowerCase()===t.toLowerCase()));a||"ini"!==t.toLowerCase()||(a=i.find((t=>"wini"===t.symbol.toLowerCase())),a={...a,name:"INI",symbol:"INI"});let r=i.find((t=>t.address.toLowerCase()===e.toLowerCase()));r||"ini"!==e.toLowerCase()||(r=i.find((t=>"wini"===t.symbol.toLowerCase())),r={...r,name:"INI",symbol:"INI"}),a&&r&&(this.fromCur=a,this.toCur=r),this.mark="",this.autoFillCurrency.inputCurrency="",this.autoFillCurrency.outputCurrency=""}},handleSwitch(){this.turnAround(),this.handleTimerGetAllPair(),this.handleApproveBtnShow(),this.handleCurBalance()},turnAround(){const t={...this.toCur};this.toCur={...this.fromCur},this.fromCur={...t};const s=this.toInput;this.toInput=this.fromInput,this.fromInput=s,this.inputSource="from"===this.inputSource?"to":"from"},handleTimerGetAllPair(){this.handleGetAllPair(),window.clearTimeout(this.timerAllPair);const t=this;this.timerAllPair=setInterval((async()=>{await t.handleGetAllPair()}),3e3)},async handleGetAllPair(){if(!this.isConnectWallet)return;if(!M.x9.includes(this.currentNetworkID))return;if(""==this.fromCur.address||""==this.toCur.address)return;if(this.getWrap||this.getWithdraw)return this.allpaths=[],void this.getAmounts();let t=(0,r.i1)(this.fromCur,this.toCur);const s=t.map((t=>{const s=(0,n.RY)(),e=s.methods.getPair(t.fromCur.address,t.toCur.address).call();return e}));let e=await Promise.all(s),i=[];for(let r=0;r<t.length;r++){const s=e[r];"0x0000000000000000000000000000000000000000"!=s&&i.push({lpAddress:s,...t[r]})}let a=i.map((t=>{const s=(0,n.di)(t.lpAddress),e=s.methods.getReserves().call();return e}));const o=await Promise.all(a);let h=i.map(((t,s)=>{let e=JSON.parse(JSON.stringify(t));return e.fromCur.address.toLowerCase()<e.toCur.address.toLowerCase()?(e.fromCur.reserves=o[s].reserve0,e.toCur.reserves=o[s].reserve1):(e.fromCur.reserves=o[s].reserve1,e.toCur.reserves=o[s].reserve0),e})),l=[];for(let r of h)r.fromCur.address==this.fromCur.address&&l.push(r);let c=[];for(let r of h)r.toCur.address==this.toCur.address&&c.push(r);let p=[];for(let r=0;r<l.length;r++){const t=l[r],s=c.find((s=>t.toCur.address==s.fromCur.address));s&&s.toCur.address==this.toCur.address?p.push([t,s]):t.toCur.address==this.toCur.address&&p.push([t])}this.allpaths=p,this.getAmounts()},getAmountsOut(){if(this.insufficientLiquidityShow=!1,0==parseFloat(this.fromInput)||""==this.fromInput||" "==this.fromInput)return this.toInput="",void(this.priceShow=!1);if(""==this.fromCur.address||""==this.toCur.address)return this.toInput="",void(this.priceShow=!1);if(this.getWrap||this.getWithdraw)return void(this.toInput=this.fromInput);let t;t=this.multipath?this.allpaths.filter((t=>1==t.length)):this.allpaths;let s=[];if(t.forEach((t=>{t.forEach((t=>{s.push(t)}))})),0==s.length)return console.log("不支持的交易对"),this.toInput="",void(this.priceShow=!1);let e=s.map((t=>{let s=JSON.parse(JSON.stringify(t,H.gn)),e=new W.TokenAmount((0,r.gf)(s.fromCur),W.JSBI.BigInt(s.fromCur.reserves)),i=new W.TokenAmount((0,r.gf)(s.toCur),W.JSBI.BigInt(s.toCur.reserves)),a=new W.Pair(e,i);return a}));const i=(0,r.lI)(this.fromInput,(0,r.gf)(this.fromCur)),a=(0,r.gf)(this.toCur),o=W.Trade.bestTradeExactIn(e,i,a,{maxNumResults:1,maxHops:3});if(0==o.length)this.insufficientLiquidityShow=!0,this.priceShow=!1,this.toInput="";else{this.currentTrade=o[0],this.toInput=this.currentTrade.outputAmount.toSignificant(6);const t=new W.Percent(W.JSBI.BigInt(1),W.JSBI.BigInt(1e4));let{priceImpactWithoutFee:s,realizedLPFee:e}=(0,r.sx)(this.currentTrade);this.priceImpact=s.lessThan(t)?"<0.01%":s.toFixed(2)+"%",this.fee=e.toSignificant(6);const i=(0,h.F8)(this.slippage,100);this.inputOutMin=(0,h.QX)((0,h.O)(this.toInput,(0,h.iE)(this.toInput,i)),4),this.getPairPrice()}},getAmountsIn(){if(this.insufficientLiquidityShow=!1,0==parseFloat(this.toInput)||""==this.toInput||" "==this.toInput)return this.fromInput="",void(this.priceShow=!1);if(""==this.fromCur.address||""==this.toCur.address)return this.fromInput="",void(this.priceShow=!1);if(this.getWrap||this.getWithdraw)return void(this.fromInput=this.toInput);let t;t=this.multipath?this.allpaths.filter((t=>1==t.length)):this.allpaths;let s=[];if(t.forEach((t=>{t.forEach((t=>{s.push(t)}))})),0==s.length)return this.fromInput="",void(this.priceShow=!1);let e=s.map((t=>{let s=JSON.parse(JSON.stringify(t,H.gn)),e=new W.TokenAmount((0,r.gf)(s.fromCur),W.JSBI.BigInt(s.fromCur.reserves)),i=new W.TokenAmount((0,r.gf)(s.toCur),W.JSBI.BigInt(s.toCur.reserves)),a=new W.Pair(e,i);return a}));const i=(0,r.lI)(this.toInput,(0,r.gf)(this.toCur)),a=(0,r.gf)(this.fromCur),o=W.Trade.bestTradeExactOut(e,a,i,{maxNumResults:1,maxHops:3});if(0==o.length)this.insufficientLiquidityShow=!0,this.priceShow=!1,this.fromInput="";else{this.currentTrade=o[0],this.fromInput=this.currentTrade.inputAmount.toSignificant(6);const t=new W.Percent(W.JSBI.BigInt(1),W.JSBI.BigInt(1e4));let{priceImpactWithoutFee:s,realizedLPFee:e}=(0,r.sx)(this.currentTrade);this.priceImpact=s.lessThan(t)?"<0.01%":s.toFixed(2)+"%",this.fee=e.toSignificant(6);const i=(0,h.F8)(this.slippage,100);this.inputInMax=(0,h.QX)((0,h.BS)(this.fromInput,(0,h.iE)(this.fromInput,i)),2),this.getPairPrice()}},getPairPrice(){if(0==parseFloat(this.fromInput)||0==parseFloat(this.toInput))return void(this.fromInput="");if(""==this.fromCur.address||""==this.toCur.address)return void(this.fromInput="");const t=parseFloat(this.fromInput),s=parseFloat(this.toInput);if(this.priceDirection){const e=(0,h.F8)(t,s);this.price=(0,h.QX)(e)}else{const e=(0,h.F8)(s,t);this.price=(0,h.QX)(e)}this.priceShow=!0},getAmounts(){"from"===this.inputSource&&this.getAmountsOut(),"to"===this.inputSource&&this.getAmountsIn()},changePriceDirection(){this.priceDirection=!this.priceDirection,this.getPairPrice()},setSwapDetail(){this.swapDetail.inputInMax=this.inputInMax,this.swapDetail.inputOutMin=this.inputOutMin,this.swapDetail.inputSource=this.inputSource,this.swapDetail.price=this.price,this.swapDetail.fromInput=this.fromInput,this.swapDetail.toInput=this.toInput,this.swapDetail.priceImpact=this.priceImpact,this.swapDetail.fee=this.fee},handleSetting(){this.isShowSetting=!0},handleCloseSetting(){this.isShowSetting=!1},handleShowImport(t){this.importCurrency=t,this.isShowImport=!0},handleCloseImport(){this.isShowImport=!1,this.importCurrency=""},handleImport(t){try{const s=(0,c.F2)().toString();let e=E.I.get(s)??[];e.push(t),E.I.set(s,e)}catch(s){const e=(0,c.F2)().toString();let i=JSON.stringify([t]);E.I.set(e,i)}this.isShowImport=!1,this.importCurrency="",this.handleSelect(t)},handleManage(){this.isShowManage=!0},handleShowToken(t){this.tokenSource=t,this.isShowToken=!0},handleCloseToken(){this.isShowToken=!1},handleSelect(t){this.isShowToken=!1,"from"==this.tokenSource?t.address==this.toCur.address&&t.symbol==this.toCur.symbol?this.turnAround():this.fromCur=t:t.address==this.fromCur.address&&t.symbol==this.fromCur.symbol?this.turnAround():this.toCur=t,this.handleTimerGetAllPair(),this.handleApproveBtnShow(),this.handleCurBalance()},async handleDeposit(){try{const t=(0,n.dI)(),s=(0,h.C_)(this.fromInput),e=await t.methods.deposit().estimateGas({from:this.walletAddress,value:s});await t.methods.deposit().send({from:this.walletAddress,value:s,gas:(0,h.l4)(e),gasPrice:p.Ay$.utils.numberToHex(this.gasPrice)}).on("transactionHash",(t=>{const s=`${this.fromInput} ${this.fromCur.symbol} 'Wrap' ${this.toInput} ${this.toCur.symbol}`,e="Transaction receipt",i={hash:t,title:e,message:s,addedTime:(new Date).getTime(),from:this.walletAddress};this.$store.dispatch("wallet/setTransactions",i)})).on("receipt",(t=>{})).catch("error",(function(t,s){throw t}))}catch(t){this.$notify({message:this.$t(t.message)||this.$t(t.err.message),duration:2500,showClose:!1,customClass:"notifyClass"})}},async handleWithdraw(){try{const t=(0,n.dI)(),s=(0,h.C_)(this.fromInput),e=await t.methods.withdraw(s).estimateGas({from:this.walletAddress});await t.methods.withdraw(s).send({from:this.account,gas:(0,h.l4)(e),gasPrice:p.Ay$.utils.numberToHex(this.gasPrice)}).on("transactionHash",(t=>{const s=`${this.fromInput} ${this.fromCur.symbol} 'Wrap' ${this.toInput} ${this.toCur.symbol}`,e="Transaction receipt",i={hash:t,title:e,message:s,addedTime:(new Date).getTime(),from:this.walletAddress};this.$store.dispatch("wallet/setTransactions",i)})).on("receipt",(t=>{})).catch("error",(function(t,s){throw t}))}catch(t){this.$notify({message:this.$t(t.message)||this.$t(t.err.message),duration:2500,showClose:!1,customClass:"notifyClass"})}},async swapExactETHForTokens(t,s,e,i,a){try{const r=(0,n._g)(),o=await r.methods.swapExactETHForTokens(s,e,i,a).estimateGas({from:this.walletAddress,value:t});this.isShowSwap=!0,this.pendingDetailShow=!0,await r.methods.swapExactETHForTokens(s,e,i,a).send({from:this.walletAddress,value:t,gas:(0,h.l4)(o),gasPrice:p.Ay$.utils.numberToHex(this.gasPrice)}).on("transactionHash",(t=>{const s=`${this.fromInput} ${this.fromCur.symbol} 'swap' ${this.toInput} ${this.toCur.symbol}`,e="Transaction receipt",i={hash:t,title:e,message:s,addedTime:(new Date).getTime(),from:this.walletAddress};this.$store.dispatch("wallet/setTransactions",i),this.pendingDetail.status=1,this.pendingDetail.hash=t})).catch("error",((t,s)=>{throw this.pendingDetail.status=2,t}))}catch(r){this.pendingDetail.status=2,this.$notify({message:this.$t(r.message)||this.$t(r.err.message),duration:2500,showClose:!1,customClass:"notifyClass"})}},async swapETHForExactTokens(t,s,e,i,a){try{const r=(0,n._g)(),o=await r.methods.swapETHForExactTokens(t,e,i,a).estimateGas({from:this.walletAddress,value:s}).catch((async o=>{const n=await r.methods.swapExactETHForTokensSupportingFeeOnTransferTokens(t,e,i,a).estimateGas({from:this.walletAddress,value:s});this.isShowSwap=!0,this.pendingDetailShow=!0,r.methods.swapExactETHForTokensSupportingFeeOnTransferTokens(t,e,i,a).send({from:this.walletAddress,value:s,gas:(0,h.l4)(n),gasPrice:p.Ay$.utils.numberToHex(this.gasPrice)}).on("transactionHash",(t=>{const s=`${this.fromInput} ${this.fromCur.symbol} 'swap' ${this.toInput} ${this.toCur.symbol}`,e="Transaction receipt",i={hash:t,title:e,message:s,addedTime:(new Date).getTime(),from:this.walletAddress};this.$store.dispatch("wallet/setTransactions",i),this.pendingDetail.status=1,this.pendingDetail.hash=t})).catch("error",((t,s)=>{throw this.pendingDetail.status=2,t}))}));if(!o)return;this.isShowSwap=!0,this.pendingDetailShow=!0,await r.methods.swapETHForExactTokens(t,e,i,a).send({from:this.walletAddress,value:s,gas:(0,h.l4)(o),gasPrice:p.Ay$.utils.numberToHex(this.gasPrice)}).on("transactionHash",(t=>{const s=`${this.fromInput} ${this.fromCur.symbol} 'swap' ${this.toInput} ${this.toCur.symbol}`,e="Transaction receipt",i={hash:t,title:e,message:s,addedTime:(new Date).getTime(),from:this.walletAddress};this.$store.dispatch("wallet/setTransactions",i),this.pendingDetail.status=1,this.pendingDetail.hash=t})).catch("error",((t,s)=>{throw this.pendingDetail.status=2,t}))}catch(r){this.pendingDetail.status=2,this.$notify({message:this.$t(r.message)||this.$t(r.err.message),duration:2500,showClose:!1,customClass:"notifyClass"})}},async swapExactTokensForETH(t,s,e,i,a){try{const r=(0,n._g)(),o=await r.methods.swapExactTokensForETH(t,s,e,i,a).estimateGas({from:this.walletAddress});this.isShowSwap=!0,this.pendingDetailShow=!0,await r.methods.swapExactTokensForETH(t,s,e,i,a).send({from:this.walletAddress,gas:(0,h.l4)(o),gasPrice:p.Ay$.utils.numberToHex(this.gasPrice)}).on("transactionHash",(t=>{const s=`${this.fromInput} ${this.fromCur.symbol} 'swap' ${this.toInput} ${this.toCur.symbol}`,e="Transaction receipt",i={hash:t,title:e,message:s,addedTime:(new Date).getTime(),from:this.walletAddress};this.$store.dispatch("wallet/setTransactions",i),this.pendingDetail.status=1,this.pendingDetail.hash=t})).catch("error",((t,s)=>{throw this.pendingDetail.status=2,t}))}catch(r){this.pendingDetail.status=2,this.$notify({message:this.$t(r.message)||this.$t(r.err.message),duration:2500,showClose:!1,customClass:"notifyClass"})}},async swapTokensForExactETH(t,s,e,i,a){try{const r=(0,n._g)(),o=await r.methods.swapTokensForExactETH(t,s,e,i,a).estimateGas({from:this.walletAddress});this.isShowSwap=!0,this.pendingDetailShow=!0,await r.methods.swapTokensForExactETH(t,s,e,i,a).send({from:this.walletAddress,gas:(0,h.l4)(o),gasPrice:p.Ay$.utils.numberToHex(this.gasPrice)}).on("transactionHash",(t=>{const s=`${this.fromInput} ${this.fromCur.symbol} 'swap' ${this.toInput} ${this.toCur.symbol}`,e="Transaction receipt",i={hash:t,title:e,message:s,addedTime:(new Date).getTime(),from:this.walletAddress};this.$store.dispatch("wallet/setTransactions",i),this.pendingDetail.status=1,this.pendingDetail.hash=t})).catch("error",((t,s)=>{throw this.pendingDetail.status=2,t}))}catch(r){this.pendingDetail.status=2,this.$notify({message:this.$t(r.message)||this.$t(r.err.message),duration:2500,showClose:!1,customClass:"notifyClass"})}},async swapExactTokensForTokens(t,s,e,i,a){try{const r=(0,n._g)(),o=await r.methods.swapExactTokensForTokens(t,s,e,i,a).estimateGas({from:this.walletAddress}).catch((async o=>{const n=await r.methods.swapExactTokensForTokensSupportingFeeOnTransferTokens(t,s,e,i,a).estimateGas({from:this.walletAddress});this.isShowSwap=!0,this.pendingDetailShow=!0,r.methods.swapExactTokensForTokensSupportingFeeOnTransferTokens(t,s,e,i,a).send({from:this.walletAddress,gas:(0,h.l4)(n),gasPrice:p.Ay$.utils.numberToHex(this.gasPrice)}).on("transactionHash",(t=>{const s=`${this.fromInput} ${this.fromCur.symbol} 'swap' ${this.toInput} ${this.toCur.symbol}`,e="Transaction receipt",i={hash:t,title:e,message:s,addedTime:(new Date).getTime(),from:this.walletAddress};this.$store.dispatch("wallet/setTransactions",i),this.pendingDetail.status=1,this.pendingDetail.hash=t})).catch("error",((t,s)=>{throw this.pendingDetail.status=2,t}))}));if(!o)return;this.isShowSwap=!0,this.pendingDetailShow=!0,await r.methods.swapExactTokensForTokens(t,s,e,i,a).send({from:this.walletAddress,gas:(0,h.l4)(o),gasPrice:p.Ay$.utils.numberToHex(this.gasPrice)}).on("transactionHash",(t=>{const s=`${this.fromInput} ${this.fromCur.symbol} 'swap' ${this.toInput} ${this.toCur.symbol}`,e="Transaction receipt",i={hash:t,title:e,message:s,addedTime:(new Date).getTime(),from:this.walletAddress};this.$store.dispatch("wallet/setTransactions",i),this.pendingDetail.status=1,this.pendingDetail.hash=t,P(t,(t=>{}))})).catch("error",((t,s)=>{throw this.pendingDetail.status=2,t}))}catch(r){this.pendingDetail.status=2,this.$notify({message:this.$t(r.message)||this.$t(r.err.message),duration:2500,showClose:!1,customClass:"notifyClass"})}},async swapTokensForExactTokens(t,s,e,i,a){try{const r=(0,n._g)(),o=await r.methods.swapTokensForExactTokens(t,s,e,i,a).estimateGas({from:this.walletAddress});this.isShowSwap=!0,this.pendingDetailShow=!0,await r.methods.swapTokensForExactTokens(t,s,e,i,a).send({from:this.walletAddress,gas:(0,h.l4)(o),gasPrice:p.Ay$.utils.numberToHex(this.gasPrice)}).on("transactionHash",(t=>{const s=`${this.fromInput} ${this.fromCur.symbol} 'swap' ${this.toInput} ${this.toCur.symbol}`,e="Transaction receipt",i={hash:t,title:e,message:s,addedTime:(new Date).getTime(),from:this.walletAddress};this.$store.dispatch("wallet/setTransactions",i),this.pendingDetail.status=1,this.pendingDetail.hash=t})).catch("error",(t=>{throw this.pendingDetail.status=2,t}))}catch(r){this.pendingDetail.status=2,this.$notify({message:this.$t(r.message)||this.$t(r.err.message),duration:2500,showClose:!1,customClass:"notifyClass"})}}}},L=N,O=(0,C.A)(L,i,a,!1,null,"1163172e",null),R=O.exports},86339:function(t,s,e){t.exports=e.p+"img/icon_trade_refresh.27018105.svg"}}]);